type: strapi
development:
  services:
    {MODULE_NAME}:
      image: dashfy/dev-{MODULE_NAME}
      env_file: ./modules/{MODULE_NAME}/.env
      build:
        context: ./modules/{MODULE_NAME}
        args:
          ENVIRONMENT: ${UPPERCASE_MODULE_NAME}_ENVIRONMENT
          DATABASE_CLIENT: ${UPPERCASE_MODULE_NAME}_DATABASE_CLIENT
          API_PORT: ${UPPERCASE_MODULE_NAME}_API_PORT
          ADMIN_PORT: ${UPPERCASE_MODULE_NAME}_ADMIN_PORT
      container_name: dashfy-dev-{MODULE_NAME}
      restart: unless-stopped
      networks:
        - dashfy-network
      volumes:
        - "./modules/{MODULE_NAME}/api:/usr/source/app/api"
        - "./modules/{MODULE_NAME}/config:/usr/source/app/config"
        - "./modules/{MODULE_NAME}/exports:/usr/source/app/exports"
        - "./modules/{MODULE_NAME}/public:/usr/source/app/public"
        - "./modules/{MODULE_NAME}/extensions:/usr/source/app/extensions"
        - "./modules/{MODULE_NAME}/components:/usr/source/app/components"
        - "./modules/{MODULE_NAME}/hooks:/usr/source/app/hooks"
        - "./modules/{MODULE_NAME}/package.json:/usr/source/app/package.json"
        - "./modules/{MODULE_NAME}/package-lock.json:/usr/source/app/package-lock.json"
        - "./modules/{MODULE_NAME}/favicon.ico:/usr/source/app/favicon.ico"
      ports:
        - "$API_PORT:${UPPERCASE_MODULE_NAME}_API_PORT"
        - "$ADMIN_PORT:${UPPERCASE_MODULE_NAME}_ADMIN_PORT"

production:
  services:
    {MODULE_NAME}:
      image: dashfy/{MODULE_NAME}:latest
      build:
        context: ./modules/{MODULE_NAME}
        dockerfile: Dockerfile.prod
        args:
          ENVIRONMENT: ${UPPERCASE_MODULE_NAME}_ENVIRONMENT
          DATABASE_CLIENT: ${UPPERCASE_MODULE_NAME}_DATABASE_CLIENT
          API_PORT: ${UPPERCASE_MODULE_NAME}_API_PORT
          ADMIN_PORT: ${UPPERCASE_MODULE_NAME}_ADMIN_PORT
      container_name: dashfy-{MODULE_NAME}
      restart: unless-stopped
      networks:
        - dashfy-network
      ports:
        - "$API_PORT:${UPPERCASE_MODULE_NAME}_API_PORT"
        - "$ADMIN_PORT:${UPPERCASE_MODULE_NAME}_ADMIN_PORT"
